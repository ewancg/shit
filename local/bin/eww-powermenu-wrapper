#!/usr/bin/env bash

function show_backdrop {
    for i in $(seq 0 "$(expr $(hyprctl -j monitors | gojq -r length) - 1)"); do {
            export model="$(hyprctl -j monitors | gojq -r "first(.[$i]) | .model")"
            eww open backdrop --screen="$model" --id="$i" &
    }
    done

}

export timeout=5

case $1 in
  "suspend") 
    ;&
  "poweroff") 
    ;&
  "reboot") 
    export verb="$1"
    export start="$(expr $(date +%s) + $timeout)"

    export outfile="/tmp/timeout-timer"
    rm -rf "$outfile"
    nohup eww-display-countdown "$outfile" &

    nohup eww-timeout-event "$verb" "$timeout" &
    show_backdrop
    eww-toggle-window prompt default --arg uid="${uuidgen}" --arg verb="$verb" &

    ;;
  *)
    notify-send "Unknown parameter"
    ;;
esac